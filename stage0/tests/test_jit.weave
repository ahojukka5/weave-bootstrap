(program
  (name "test_jit")
  (doc "Test JIT compilation from Weave code")

  (entry main
    (params (argc Int32) (argv (ptr String)))
    (returns Int32)
    (body
      (do
        ;; JIT compile a simple add function and call it
        (let ir String "define i32 @add(i32 %a, i32 %b) {\n  %sum = add i32 %a, %b\n  ret i32 %sum\n}\n")
        (let result Int32 (ccall "llvm_jit_call_i32_i32_i32"
                                 (returns Int32)
                                 (args (String ir) (String "add") (Int32 10) (Int32 20))))
        (if-stmt (== result 30)
          (do
            (ccall "puts" (returns Int32) (args (String "✅ JIT test passed: add(10, 20) = 30")))
            (return 0)
          )
          (do
            (ccall "puts" (returns Int32) (args (String "❌ JIT test failed")))
            (return 1)
          )
        )
      )
    )
  )
)

