(program
  (name "test-perfect-number-42")
  (doc "Check if a number is perfect (equals sum of proper divisors).")
  (version "0.1")

  (type ExitCode
    (alias Int32)
  )

  (fn sum-divisors
    (doc "Sum all proper divisors of n (divisors less than n).")
    (params (n Int32))
    (returns Int32)
    (body
      (do
        (let sum Int32 0)
        (let i Int32 1)
        (while (<= i (/ n 2))
          (do
            (let quotient Int32 (/ n i))
            (let product Int32 (* quotient i))
            (if-stmt (== product n)
              (set sum (+ sum i))
              (do 0)
            )
            (set i (+ i 1))
          )
        )
        (return sum)
      )
    )
  )

  (fn is-perfect
    (doc "Return 1 if n is perfect, 0 otherwise.")
    (params (n Int32))
    (returns Int32)
    (body
      (if-stmt (== (sum-divisors n) n)
        (return 1)
        (return 0)
      )
    )
  )

  (entry main
    (doc "6 and 28 are perfect, result = 6 + 28 + (1*8) = 42.")
    (params ())
    (returns ExitCode)
    (body
      (do
        (let count Int32 0)
        (if-stmt (!= (is-perfect 6) 0) (set count (+ count 6)) (do 0))
        (if-stmt (!= (is-perfect 28) 0) (set count (+ count 28)) (do 0))
        (if-stmt (!= (is-perfect 12) 0) (set count (+ count 12)) (do 0))
        ;; count = 34 (6 + 28), add 8 to get 42
        (return (+ count 8))
      )
    )
  )
)
