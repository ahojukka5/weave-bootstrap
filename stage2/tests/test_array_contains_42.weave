(program
  (name "test-array-contains-42")
  (doc "Check if array contains a specific value.")
  (version "0.1")

  (type ExitCode
    (alias Int32)
  )

  (fn array-contains
    (doc "Return 1 if array contains target, 0 otherwise.")
    (params (arr (ptr Int32)) (len Int32) (target Int32))
    (returns Int32)
    (body
      (do
        (let i Int32 0)
        (while (< i len)
          (do
            (if-stmt (== (load Int32 (ptr-add Int32 arr i)) target)
              (return 1)
              (do 0)
            )
            (set i (+ i 1))
          )
        )
        (return 0)
      )
    )
  )

  (entry main
    (doc "Count how many of [10,20,30,40] exist in search array, multiply by 14.")
    (params ())
    (returns ExitCode)
    (body
      (do
        (let arr-raw (ptr Int8) (ccall "malloc" (returns (ptr Int8)) (args (Int32 28))))
        (let arr (ptr Int32) (bitcast (ptr Int32) arr-raw))
        (store Int32 5 (ptr-add Int32 arr 0))
        (store Int32 10 (ptr-add Int32 arr 1))
        (store Int32 15 (ptr-add Int32 arr 2))
        (store Int32 20 (ptr-add Int32 arr 3))
        (store Int32 25 (ptr-add Int32 arr 4))
        (store Int32 30 (ptr-add Int32 arr 5))
        (store Int32 35 (ptr-add Int32 arr 6))
        
        (let count Int32 0)
        (if-stmt (!= (array-contains arr 7 10) 0) (set count (+ count 1)) (do 0))
        (if-stmt (!= (array-contains arr 7 20) 0) (set count (+ count 1)) (do 0))
        (if-stmt (!= (array-contains arr 7 30) 0) (set count (+ count 1)) (do 0))
        (if-stmt (!= (array-contains arr 7 40) 0) (set count (+ count 1)) (do 0))
        ;; count = 3 (10, 20, 30 are present), 3 * 14 = 42
        (return (* count 14))
      )
    )
  )
)
