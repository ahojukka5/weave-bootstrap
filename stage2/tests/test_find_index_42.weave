(program
  (name "test-find-index-42")
  (doc "Find index of element in array.")
  (version "0.1")

  (type ExitCode
    (alias Int32)
  )

  (fn find-index
    (doc "Return index of target in array, or -1 if not found.")
    (params (arr (ptr Int32)) (len Int32) (target Int32))
    (returns Int32)
    (body
      (do
        (let i Int32 0)
        (while (< i len)
          (do
            (let ptr (ptr Int32) (ptr-add Int32 arr i))
            (if-stmt (== (load Int32 ptr) target)
              (return i)
              (do 0)
            )
            (set i (+ i 1))
          )
        )
        (return (- 0 1))
      )
    )
  )

  (entry main
    (doc "Find index of 30 in [10,20,30,40,50], multiply by 14 = 42.")
    (params ())
    (returns ExitCode)
    (body
      (do
        (let arr-raw (ptr Int8) (ccall "malloc" (returns (ptr Int8)) (args (Int32 20))))
        (let arr (ptr Int32) (bitcast (ptr Int32) arr-raw))
        (store Int32 10 (ptr-add Int32 arr 0))
        (store Int32 20 (ptr-add Int32 arr 1))
        (store Int32 30 (ptr-add Int32 arr 2))
        (store Int32 40 (ptr-add Int32 arr 3))
        (store Int32 50 (ptr-add Int32 arr 4))
        
        (let idx Int32 (find-index arr 5 30))
        ;; idx = 2, 2 * 14 + 14 = 42
        (return (+ (* idx 14) 14))
      )
    )
  )
)
