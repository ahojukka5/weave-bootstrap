(program
  (name "test-fibonacci-hybrid-42")
  (doc "Calculate Fibonacci with iterative helper and recursive structure.")
  (version "0.1")

  (type ExitCode
    (alias Int32)
  )

  (fn fib-iter
    (doc "Calculate nth Fibonacci number iteratively (helper).")
    (params (n Int32))
    (returns Int32)
    (body
      (do
        (if-stmt (<= n 1)
          (return n)
          (do 0)
        )
        (let a Int32 0)
        (let b Int32 1)
        (let i Int32 2)
        (while (<= i n)
          (do
            (let temp Int32 (+ a b))
            (set a b)
            (set b temp)
            (set i (+ i 1))
          )
        )
        (return b)
      )
    )
  )

  (fn compute-result
    (doc "Use fib-iter to compute final result.")
    (params)
    (returns Int32)
    (body (* (fib-iter 8) 2))
  )

  (entry main
    (doc "Calculate fib(8) * 2 = 21 * 2 = 42 via helper function.")
    (params ())
    (returns ExitCode)
    (body (compute-result))
  )
)
