(program
  (name "test-median-42")
  (doc "Find median of sorted array.")
  (version "0.1")

  (type ExitCode
    (alias Int32)
  )

  (fn median
    (doc "Return median of sorted array (middle element for odd length).")
    (params (arr (ptr Int32)) (len Int32))
    (returns Int32)
    (body
      (do
        (let mid Int32 (/ len 2))
        (return (load Int32 (ptr-add Int32 arr mid)))
      )
    )
  )

  (entry main
    (doc "Median of sorted [10,20,30,42,50,60,70] is 42.")
    (params ())
    (returns ExitCode)
    (body
      (do
        (let arr-raw (ptr Int8) (ccall "malloc" (returns (ptr Int8)) (args (Int32 28))))
        (let arr (ptr Int32) (bitcast (ptr Int32) arr-raw))
        (store Int32 10 (ptr-add Int32 arr 0))
        (store Int32 20 (ptr-add Int32 arr 1))
        (store Int32 30 (ptr-add Int32 arr 2))
        (store Int32 42 (ptr-add Int32 arr 3))
        (store Int32 50 (ptr-add Int32 arr 4))
        (store Int32 60 (ptr-add Int32 arr 5))
        (store Int32 70 (ptr-add Int32 arr 6))
        (return (median arr 7))
      )
    )
  )
)
