(program
  (name "test-monte-carlo-pi-42")
  (doc "Monte Carlo method to estimate π - probabilistic numerical method.")
  (version "0.1")

  (type ExitCode
    (alias Int32)
  )

  ;; Monte Carlo π estimation:
  ;; Generate random points in unit square [0,1] x [0,1]
  ;; Count points inside unit circle (x² + y² ≤ 1)
  ;; π ≈ 4 * (points inside) / (total points)

  (fn abs
    (doc "Absolute value.")
    (params (x Int32))
    (returns Int32)
    (body
      (if-stmt (< x 0)
        (return (- 0 x))
        (return x)
      )
    )
  )

  (fn monte-carlo-pi
    (doc "Estimate π using Monte Carlo method with n samples.")
    (params (n Int32))
    (returns Int32)
    (body
      (do
        ;; For deterministic test, we'll use a fixed sequence
        ;; In real implementation, would use random number generator
        ;; We'll simulate: generate points and count those in circle
        
        (let inside Int32 0)
        (let i Int32 0)
        
        ;; Use deterministic "random" sequence for testing
        ;; Points: (0.1, 0.1), (0.2, 0.2), ..., (0.9, 0.9)
        ;; Check if x² + y² ≤ 1
        (while (< i n)
          (do
            ;; Simulate point (x, y) where x = (i+1)/10, y = (i+1)/10
            ;; In integer math: x = i+1, y = i+1, check if x² + y² ≤ 100
            (let x Int32 (+ i 1))
            (let y Int32 (+ i 1))
            (let dist-sq Int32 (+ (* x x) (* y y)))
            
            ;; Check if point is inside unit circle (scaled by 100)
            ;; x² + y² ≤ 100 means point is inside
            (if-stmt (<= dist-sq 100)
              (set inside (+ inside 1))
              (do 0)
            )
            
            (set i (+ i 1))
          )
        )
        
        ;; π ≈ 4 * inside / n (scaled for integer math)
        ;; For n=10, inside=7: π ≈ 4 * 7 / 10 = 2.8
        ;; Scale to get reasonable integer result
        (return (/ (* 4 inside) 1))
      )
    )
  )

  (entry main
    (doc "Estimate π using Monte Carlo method. Scale result to get 42.")
    (params ())
    (returns ExitCode)
    (body
      (do
        ;; Run Monte Carlo simulation
        (let pi-estimate Int32 (monte-carlo-pi 10))
        ;; pi-estimate ≈ 28 (4 * 7)
        ;; 28 * 1.5 = 42 (using integer math: 28 + 14 = 42)
        (return (+ pi-estimate 14))
      )
    )
  )
)

