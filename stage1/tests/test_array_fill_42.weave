(program
  (name "test-array-fill-42")
  (doc "Fill array with a specific value.")
  (version "0.1")

  (type ExitCode
    (alias Int32)
  )

  (fn array-fill
    (doc "Fill array with value for len elements.")
    (params (arr (ptr Int32)) (value Int32) (len Int32))
    (returns Int32)
    (body
      (do
        (let i Int32 0)
        (while (< i len)
          (do
            (store Int32 value (ptr-add Int32 arr i))
            (set i (+ i 1))
          )
        )
        (return 0)
      )
    )
  )

  (entry main
    (doc "Fill array of size 6 with value 7, sum all elements.")
    (params ())
    (returns ExitCode)
    (body
      (do
        (let arr-raw (ptr Int8) (ccall "malloc" (returns (ptr Int8)) (args (Int32 24))))
        (let arr (ptr Int32) (bitcast (ptr Int32) arr-raw))
        (array-fill arr 7 6)
        (let sum Int32 0)
        (let i Int32 0)
        (while (< i 6)
          (do
            (set sum (+ sum (load Int32 (ptr-add Int32 arr i))))
            (set i (+ i 1))
          )
        )
        ;; sum = 7 * 6 = 42
        (return sum)
      )
    )
  )
)
